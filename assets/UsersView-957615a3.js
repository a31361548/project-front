import{U,x as s,W as A,a6 as I,c as t,Y as l,aa as D,M as T,a0 as F,aQ as L,V as N,J as V,ab as K,aR as $,aS as j,a1 as p,ac as z,a9 as E,Z as H,ad as J,ax as M,a2 as O}from"./index-4712e515.js";import{a as Q}from"./vee-validate.esm-d7e2001b.js";import{a as R,V as w}from"./VCol-37fbc867.js";import{V as W}from"./VDataTableServer-0e469776.js";import"./VDataTable-4de18687.js";import"./VList-6d490b48.js";import"./ssrBoot-291bb583.js";import"./VDivider-808ddadf.js";import"./VMenu-1a09bab4.js";const Y=M("h1",{class:"text-center"},"會員管理",-1),re={__name:"UsersView",setup(Z){const{apiAuth:y}=O(),v=U(),c=s(!1),k=s(""),B=o=>{k.value=o._id,x.value.value=o.account,c.value=!0},x=Q("account"),P=async()=>{var o,a;try{await y.delete("/users/"+k.value),v({text:"刪除成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"back",location:"bottom"}}),n()}catch(e){console.log(e);const u=((a=(o=e==null?void 0:e.response)==null?void 0:o.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";v({text:u,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}},g=s(10),i=s([{key:"createdAt",order:"desc"}]),d=s(1),f=s([]),_=[{title:"頭像",align:"center",sortable:!1,key:"avatar"},{title:"帳號",align:"center",sortable:!0,key:"account"},{title:"信箱",align:"center",sortable:!0,key:"email"},{title:"刪除",align:"center",sortable:!1,key:"remove"}],b=s(!0),C=s(0),m=s(""),n=async()=>{var o,a,e,u;b.value=!0;try{const{data:r}=await y.get("/users/all",{params:{page:d.value,itemsPerPage:g.value,sortBy:((o=i.value[0])==null?void 0:o.key)||"createdAt",sortOrder:((a=i.value[0])==null?void 0:a.order)==="asc"?1:-1,search:m.value}});f.value.splice(0,f.value.length,...r.result.data),C.value=r.result.total}catch(r){console.log(r);const S=((u=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:u.message)||"發生錯誤，請稍後再試";v({text:S,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}b.value=!1};n();const h=()=>{d.value=1,n()};return(o,a)=>(A(),I(T,null,[t(R,null,{default:l(()=>[t(w,{cols:"12"},{default:l(()=>[Y]),_:1}),t(w,{cols:"12"},{default:l(()=>[t(W,{"items-per-page":g.value,"onUpdate:itemsPerPage":[a[1]||(a[1]=e=>g.value=e),n],"sort-by":i.value,"onUpdate:sortBy":[a[2]||(a[2]=e=>i.value=e),n],page:d.value,"onUpdate:page":[a[3]||(a[3]=e=>d.value=e),n],items:f.value,headers:_,loading:b.value,"items-length":C.value,search:m.value,hover:""},{top:l(()=>[t(F,{label:"搜尋","append-icon":"mdi-magnify",modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=e=>m.value=e),"onClick:append":h,onKeydown:L(h,["enter"])},null,8,["modelValue"])]),"item.avatar":l(({item:e})=>[t(N,{src:e.avatar,height:"50px",contain:""},null,8,["src"])]),"item.remove":l(({item:e})=>[t(V,{icon:"mdi-delete",variant:"text",color:"red",onClick:u=>B(e)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1}),t(D,{modelValue:c.value,"onUpdate:modelValue":a[5]||(a[5]=e=>c.value=e),parsistent:"",width:"500px"},{default:l(()=>[t(K,{rounded:"lg"},{default:l(()=>[t($),t(j,{size:"50",color:"red",class:"ma-auto"},{default:l(()=>[p("mdi-alert")]),_:1}),t(z,{class:"ma-auto"},{default:l(()=>[p("是否刪除 "+E(H(x).value.value)+" 帳號?",1)]),_:1}),t(J,{style:{display:"flex","justify-content":"end"}},{default:l(()=>[t(V,{color:"red",onClick:a[4]||(a[4]=e=>c.value=!1)},{default:l(()=>[p("取消")]),_:1}),t(V,{color:"red",onClick:P},{default:l(()=>[p("確認刪除")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{re as default};
